<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decoding Spotify Track Popularity | Data Story</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="/logo.png">
    <style>
        :root {
            --background: #0f0f0f;
            --foreground: #e0e0e0;
            --surface: #1a1a1a;
            --surface-hover: #2a2a2a;
            --primary: #2d6a4f;
            --primary-light: #95d5b2;
            --accent: #b7e4c7;
            --muted: #888888;
            --negative: #e57373;
            --warning: #ffb74d;
            --purple: #b388ff;
            --blue: #64b5f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            color: var(--foreground);
            line-height: 1.6;
        }

        .site-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: var(--background)/80;
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--surface-hover);
            padding: 12px 24px;
        }

        .site-nav a {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .site-nav a:hover {
            color: var(--primary-light);
        }

        .site-nav .logo {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .hero {
            text-align: center;
            padding: 120px 20px 60px;
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-bottom: 1px solid var(--surface-hover);
        }

        .hero h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .hero .subtitle {
            font-size: 1.2rem;
            color: var(--muted);
            max-width: 700px;
            margin: 0 auto;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 20px;
            background: var(--surface);
            border-bottom: 1px solid var(--surface-hover);
            flex-wrap: wrap;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--surface-hover);
            border-radius: 20px;
            color: var(--muted);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .nav-tab:hover {
            border-color: var(--primary);
            color: var(--foreground);
        }

        .nav-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--background);
            font-weight: 600;
        }

        .section {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--foreground);
            margin-bottom: 24px;
            text-align: center;
        }

        .narrative {
            max-width: 800px;
            margin: 0 auto 32px;
            text-align: center;
            font-size: 1.1rem;
            color: var(--accent);
        }

        .context-note {
            background: rgba(45, 106, 79, 0.1);
            border-left: 4px solid var(--primary);
            padding: 16px 20px;
            margin: 24px 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.95rem;
        }

        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 32px 0;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--surface-hover);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: transform 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
        }

        .stat-card .value {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 8px;
        }

        .stat-card .label {
            color: var(--muted);
            font-size: 0.9rem;
        }

        .stat-card.pop { border-left: 4px solid #ff6b6b; }
        .stat-card.rap { border-left: 4px solid #ffd93d; }
        .stat-card.rock { border-left: 4px solid #6bcb77; }
        .stat-card.latin { border-left: 4px solid #ff9f43; }
        .stat-card.rb { border-left: 4px solid #a66cff; }
        .stat-card.edm { border-left: 4px solid #4ecdc4; }

        .stat-card.highlighted {
            transform: translateY(-4px);
            box-shadow: 0 0 20px rgba(149, 213, 178, 0.5), 0 0 40px rgba(45, 106, 79, 0.3);
        }

        .stat-card.dimmed {
            opacity: 0.3;
        }

        .chart-container {
            background: var(--surface);
            border: 1px solid var(--surface-hover);
            border-radius: 12px;
            padding: 24px;
        }

        .chart-container .chart-div {
            width: 100%;
        }

        .chart-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--foreground);
            margin-bottom: 16px;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(45, 106, 79, 0.15) 0%, rgba(45, 106, 79, 0.05) 100%);
            border: 1px solid rgba(45, 106, 79, 0.3);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
        }

        .insight-box h4 {
            color: var(--primary-light);
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insight-box p {
            color: var(--accent);
            font-size: 0.95rem;
        }

        .takeaway {
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            margin: 40px 0;
        }

        .takeaway h3 {
            color: var(--primary-light);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .takeaway p {
            color: var(--accent);
            font-size: 1.05rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .genre-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .genre-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--muted);
        }

        .genre-legend-item .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .footer {
            text-align: center;
            padding: 40px 20px;
            background: var(--surface);
            border-top: 1px solid var(--surface-hover);
            color: var(--muted);
            font-size: 0.9rem;
        }

        .footer a {
            color: var(--primary-light);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 24px 0;
        }

        @media (max-width: 800px) {
            .two-col {
                grid-template-columns: 1fr;
            }
        }

        .action-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 32px 0;
        }

        /* Genre cards - 6 in one row */
        .genre-cards {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 12px;
            margin: 32px 0;
        }

        @media (max-width: 1000px) {
            .genre-cards {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 600px) {
            .genre-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .genre-card {
            background: var(--surface);
            border: 1px solid var(--surface-hover);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: transform 0.2s ease, border-color 0.2s ease, opacity 0.2s ease, box-shadow 0.2s ease;
        }

        .genre-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
        }

        .genre-card.highlighted {
            transform: translateY(-4px);
            box-shadow: 0 0 20px rgba(149, 213, 178, 0.5), 0 0 40px rgba(45, 106, 79, 0.3);
        }

        .genre-card.dimmed {
            opacity: 0.3;
        }

        .genre-card .value {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 6px;
        }

        .genre-card .label {
            color: var(--muted);
            font-size: 0.75rem;
            line-height: 1.4;
        }

        .genre-card.pop { border-left: 4px solid #ff6b6b; }
        .genre-card.rap { border-left: 4px solid #ffd93d; }
        .genre-card.rock { border-left: 4px solid #6bcb77; }
        .genre-card.latin { border-left: 4px solid #ff9f43; }
        .genre-card.rb { border-left: 4px solid #a66cff; }
        .genre-card.edm { border-left: 4px solid #4ecdc4; }

        /* Full width chart stack */
        .chart-stack {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin: 32px 0;
        }

        /* Genre section master container */
        #genres.section {
            padding: 40px 20px;
        }

        .genre-section-wrapper {
            width: 100%;
            box-sizing: border-box;
        }

        .genre-section-wrapper .section-title {
            text-align: center;
            margin-bottom: 24px;
        }

        .genre-narrative {
            text-align: center;
            font-size: 1.1rem;
            color: var(--accent);
            margin-bottom: 32px;
        }

        /* Badges row - 6 items, 12px gaps = 5 gaps total = 60px */
        .genre-badges-row {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .genre-badges-row .genre-card {
            flex: 1;
            min-width: 0;
        }

        /* Charts row - 2 columns, 24px gap */
        .genre-charts-row {
            display: flex;
            gap: 24px;
        }

        .genre-charts-left {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .genre-charts-right {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        /* Force charts to fill container width */
        .genre-charts-row .chart-container {
            width: 100%;
            box-sizing: border-box;
        }

        .genre-charts-row .chart-div {
            width: 100% !important;
        }

        @media (max-width: 900px) {
            .genre-badges-row {
                flex-wrap: wrap;
            }
            .genre-badges-row .genre-card {
                flex: 1 1 calc(33.333% - 8px);
            }
            .genre-charts-row {
                flex-direction: column;
            }
        }

        @media (max-width: 500px) {
            .genre-badges-row .genre-card {
                flex: 1 1 calc(50% - 6px);
            }
        }

        /* Prevent chart overflow */
        .chart-container {
            overflow: hidden;
        }

    </style>
</head>
<body>
    <nav class="site-nav">
        <a href="https://amoredatus.com">
            <img src="/logo.png" alt="amoredatus" class="logo">
            <span>‚Üê back to amoredatus</span>
        </a>
    </nav>

    <div class="hero">
        <h1>Decoding Spotify Track Popularity</h1>
        <p class="subtitle">What makes a hit? Analyzing 32,000+ tracks to uncover the audio features, genres, and patterns that drive streaming success.</p>
    </div>

    <nav class="nav-tabs">
        <button class="nav-tab active" onclick="showSection('overview')">Overview</button>
        <button class="nav-tab" onclick="showSection('features')">Audio Features</button>
        <button class="nav-tab" onclick="showSection('genres')">Genre Deep Dive</button>
        <button class="nav-tab" onclick="showSection('insights')">Key Insights</button>
    </nav>

    <!-- OVERVIEW SECTION -->
    <section id="overview" class="section active">
        <h2 class="section-title">The Big Picture</h2>

        <div class="narrative">
            <p>Spotify's algorithm and listener behavior have created a fascinating ecosystem where certain audio characteristics consistently correlate with track popularity. By analyzing over 32,000 tracks across 6 major genres, we uncovered surprising patterns about what makes music resonate with listeners.</p>
        </div>

        <div class="stat-cards">
            <div class="stat-card">
                <div class="value">32,833</div>
                <div class="label">Total Tracks Analyzed</div>
            </div>
            <div class="stat-card">
                <div class="value">10,692</div>
                <div class="label">Unique Artists</div>
            </div>
            <div class="stat-card">
                <div class="value">6</div>
                <div class="label">Genres Covered</div>
            </div>
            <div class="stat-card">
                <div class="value">42.5</div>
                <div class="label">Average Popularity Score</div>
            </div>
        </div>

        <div class="context-note">
            <strong>About the Data:</strong> This dataset comes from Spotify's API and includes tracks from curated playlists across Pop, Rock, R&B, Latin, Rap, and EDM genres. Each track includes 12 audio features computed by Spotify's algorithms.
        </div>

        <div class="chart-container">
            <h3 class="chart-title">Popularity Distribution Across All Tracks</h3>
            <div id="popularity-histogram" class="chart-div" style="height: 350px;"></div>
        </div>

        <div class="two-col">
            <div class="chart-container">
                <h3 class="chart-title">Tracks by Genre</h3>
                <div id="genre-pie" class="chart-div" style="height: 320px;"></div>
            </div>
            <div class="chart-container">
                <h3 class="chart-title">Average Popularity by Genre</h3>
                <div id="genre-popularity-bar" class="chart-div" style="height: 320px;"></div>
            </div>
        </div>

        <div class="insight-box">
            <h4>üí° Key Finding</h4>
            <p><strong>Pop and Latin dominate popularity.</strong> While EDM has the most tracks in our dataset, Pop and Latin genres consistently achieve higher average popularity scores (47-48 vs 35 for EDM). This suggests that mainstream appeal and cultural factors play a larger role than sheer volume.</p>
        </div>
    </section>

    <!-- AUDIO FEATURES SECTION -->
    <section id="features" class="section">
        <h2 class="section-title">Audio Features Decoded</h2>

        <div class="narrative">
            <p>Spotify computes 12 audio features for every track using machine learning. These features capture everything from how "danceable" a song is to its acoustic properties. But which features actually matter for popularity?</p>
        </div>

        <div class="chart-container">
            <h3 class="chart-title">Feature Correlation with Popularity</h3>
            <div id="correlation-bar" class="chart-div" style="height: 400px;"></div>
        </div>

        <div class="context-note">
            <strong>Interpreting Correlations:</strong> Positive values mean higher feature values associate with higher popularity. Negative values mean the opposite. Note that correlations are modest ‚Äî music is complex and popularity depends on many factors beyond audio features.
        </div>

        <div class="two-col">
            <div class="insight-box">
                <h4>üìà What Boosts Popularity</h4>
                <p><strong>Acousticness (+0.085)</strong> ‚Äî Tracks with more acoustic elements tend to perform slightly better. Think unplugged sessions and intimate recordings.</p>
                <p style="margin-top: 12px;"><strong>Danceability (+0.065)</strong> ‚Äî Songs you can move to have an edge. This aligns with streaming behavior where upbeat tracks get more plays.</p>
            </div>
            <div class="insight-box">
                <h4>üìâ What Hurts Popularity</h4>
                <p><strong>Instrumentalness (-0.150)</strong> ‚Äî Tracks without vocals struggle. Listeners prefer songs with lyrics they can sing along to.</p>
                <p style="margin-top: 12px;"><strong>Duration (-0.144)</strong> ‚Äî Shorter is better. In the streaming era, long tracks get skipped before they finish.</p>
            </div>
        </div>

        <div class="chart-container">
            <h3 class="chart-title">Feature Distributions by Popularity Tier</h3>
            <div id="feature-boxplots" class="chart-div" style="height: 400px;"></div>
        </div>

        <div class="takeaway">
            <h3>The Streaming Era Formula</h3>
            <p>Keep it short, keep it danceable, and don't forget the vocals. The data confirms what the industry has observed: streaming platforms reward songs that hook listeners quickly and encourage repeat plays.</p>
        </div>
    </section>

    <!-- GENRES SECTION -->
    <section id="genres" class="section">
        <div class="genre-section-wrapper">
            <h2 class="section-title">Genre Deep Dive</h2>

            <p class="genre-narrative">Each genre has a distinct audio fingerprint. Understanding these patterns reveals why certain songs succeed within their genre and what makes crossover hits possible. <strong>Hover over any genre below to explore.</strong></p>

            <!-- All 6 badges in one row -->
            <div class="genre-badges-row">
                <div class="genre-card pop" data-genre="pop">
                    <div class="value">Pop</div>
                    <div class="label">Balanced, polished, medium energy</div>
                </div>
                <div class="genre-card rap" data-genre="rap">
                    <div class="value">Rap</div>
                    <div class="label">High speechiness, rhythmic focus</div>
                </div>
                <div class="genre-card rock" data-genre="rock">
                    <div class="value">Rock</div>
                    <div class="label">Longest tracks, lowest danceability</div>
                </div>
                <div class="genre-card latin" data-genre="latin">
                    <div class="value">Latin</div>
                    <div class="label">Highest danceability and valence</div>
                </div>
                <div class="genre-card rb" data-genre="r&b">
                    <div class="value">R&B</div>
                    <div class="label">Lowest energy, smooth and soulful</div>
                </div>
                <div class="genre-card edm" data-genre="edm">
                    <div class="value">EDM</div>
                    <div class="label">Highest energy and tempo</div>
                </div>
            </div>

            <!-- Charts in two columns -->
            <div class="genre-charts-row">
                <div class="genre-charts-left">
                    <div class="chart-container">
                        <h3 class="chart-title">Genre Audio Fingerprints</h3>
                        <div id="radar-chart" class="chart-div" style="height: 200px;"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Energy vs Danceability</h3>
                        <div id="scatter-energy-dance" class="chart-div" style="height: 200px;"></div>
                    </div>
                </div>
                <div class="genre-charts-right">
                    <div class="chart-container">
                        <h3 class="chart-title">Tempo Distribution</h3>
                        <div id="tempo-violin" class="chart-div" style="height: 448px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- INSIGHTS SECTION -->
    <section id="insights" class="section">
        <h2 class="section-title">Key Insights & Takeaways</h2>

        <div class="narrative">
            <p>After building 8 predictive models and analyzing thousands of tracks, here are the most actionable insights for understanding what drives track popularity on Spotify.</p>
        </div>

        <div class="chart-container">
            <h3 class="chart-title">Top Artists by Track Count</h3>
            <div id="top-artists-bar" class="chart-div" style="height: 450px;"></div>
        </div>

        <div class="insight-box">
            <h4>üéØ Insight #1: Duration Matters More Than You Think</h4>
            <p>Our regression models consistently showed duration as one of the strongest predictors of popularity ‚Äî but in the <em>negative</em> direction. In the streaming era where artists are paid per stream, shorter songs with high replay value outperform epic 6-minute tracks. The sweet spot appears to be 2.5-3.5 minutes.</p>
        </div>

        <div class="insight-box">
            <h4>üéØ Insight #2: Genre-Specific Rules Apply</h4>
            <p>Pop tracks are penalized for longer durations more than any other genre. Rock listeners, however, are more tolerant of longer songs. When our model included genre interactions, prediction accuracy improved significantly ‚Äî suggesting that "what works" varies dramatically by genre.</p>
        </div>

        <div class="insight-box">
            <h4>üéØ Insight #3: Energy Is a Double-Edged Sword</h4>
            <p>Surprisingly, energy has a slight <em>negative</em> correlation with popularity (-0.109). While high-energy tracks dominate EDM playlists, the most popular songs across all genres tend to have moderate energy levels. Think "Blinding Lights" rather than "Sandstorm."</p>
        </div>

        <div class="insight-box">
            <h4>üéØ Insight #4: Vocals Trump Instrumentals</h4>
            <p>Instrumentalness has the strongest negative correlation with popularity (-0.150). In an era of social media where lyrics get quoted, shared, and turned into TikTok sounds, purely instrumental tracks struggle to break through.</p>
        </div>

        <div class="takeaway">
            <h3>The Formula for a Hit (Sort Of)</h3>
            <p>If we had to distill the data into a formula: <strong>Keep it under 3.5 minutes, make it danceable, include memorable vocals, and aim for moderate energy.</strong> But remember ‚Äî the best songs break the rules. Data can inform, but creativity still leads.</p>
        </div>

        <div class="action-cards">
            <div class="chart-container" style="margin-bottom: 0;">
                <h3 class="chart-title" style="color: var(--primary-light); font-size: 1.3rem;">üíª Explore the Code & Data</h3>
                <p style="color: var(--muted); margin-bottom: 20px; font-size: 1rem;">
                    This analysis was built using Python, pandas, scikit-learn, and statsmodels. View the full Jupyter notebook with all models and visualizations on GitHub.
                </p>
                <a href="https://nbviewer.org/github/amoredatus/website/blob/main/public/projects/spotify-analysis.ipynb" target="_blank"
                   style="display: inline-block; padding: 14px 28px; background: var(--primary); color: var(--background);
                          border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 1rem;
                          transition: background 0.2s ease;">
                    View Full Notebook ‚Üí
                </a>
            </div>
        </div>
    </section>

    <footer class="footer">
        <p>Data Story by Jordan | Master of Data Science Program</p>
        <p style="margin-top: 8px;">Data Source: <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-01-21" target="_blank">TidyTuesday Spotify Dataset</a></p>
        <p style="margin-top: 12px; font-size: 0.8rem; color: #666;">Analysis completed April 2025 | 32,833 tracks analyzed</p>
    </footer>

    <script>
        // Color palette
        const colors = {
            primary: '#2d6a4f',
            primaryLight: '#95d5b2',
            accent: '#b7e4c7',
            background: '#0f0f0f',
            surface: '#1a1a1a',
            foreground: '#e0e0e0',
            muted: '#888888',
            pop: '#ff6b6b',
            rap: '#ffd93d',
            rock: '#6bcb77',
            latin: '#ff9f43',
            rb: '#a66cff',
            edm: '#4ecdc4'
        };

        const genreColors = {
            'pop': colors.pop,
            'rap': colors.rap,
            'rock': colors.rock,
            'latin': colors.latin,
            'r&b': colors.rb,
            'edm': colors.edm
        };

        const genreOrder = ['pop', 'rap', 'rock', 'latin', 'r&b', 'edm'];

        // Base layout for all charts
        const baseLayout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: colors.foreground, family: 'Inter, sans-serif' },
            margin: { t: 30, r: 30, b: 50, l: 60 },
            autosize: true,
            xaxis: {
                gridcolor: 'rgba(255,255,255,0.05)',
                zerolinecolor: 'rgba(255,255,255,0.1)'
            },
            yaxis: {
                gridcolor: 'rgba(255,255,255,0.05)',
                zerolinecolor: 'rgba(255,255,255,0.1)'
            }
        };

        const config = {
            responsive: true,
            displayModeBar: false
        };

        // Data
        const data = {
            genres: ['edm', 'rap', 'pop', 'r&b', 'latin', 'rock'],
            genreCounts: [6043, 5746, 5507, 5431, 5155, 4951],
            genrePopularity: [34.83, 43.22, 47.74, 41.22, 47.03, 41.73],
            features: ['acousticness', 'danceability', 'loudness', 'valence', 'speechiness', 'tempo', 'liveness', 'energy', 'duration_ms', 'instrumentalness'],
            correlations: [0.085, 0.065, 0.058, 0.033, 0.007, -0.005, -0.055, -0.109, -0.144, -0.150],
            genreFeatures: {
                'pop': { danceability: 0.639, energy: 0.701, speechiness: 0.074, acousticness: 0.171, valence: 0.504 },
                'rap': { danceability: 0.718, energy: 0.651, speechiness: 0.198, acousticness: 0.192, valence: 0.505 },
                'rock': { danceability: 0.521, energy: 0.733, speechiness: 0.058, acousticness: 0.145, valence: 0.537 },
                'latin': { danceability: 0.713, energy: 0.708, speechiness: 0.103, acousticness: 0.211, valence: 0.606 },
                'r&b': { danceability: 0.670, energy: 0.591, speechiness: 0.117, acousticness: 0.260, valence: 0.531 },
                'edm': { danceability: 0.655, energy: 0.802, speechiness: 0.087, acousticness: 0.082, valence: 0.401 }
            },
            topArtists: ['Martin Garrix', 'Queen', 'The Chainsmokers', 'David Guetta', 'Don Omar', 'Drake', 'Dimitri Vegas & Like Mike', 'Calvin Harris', 'Hardwell', 'Kygo'],
            artistCounts: [161, 136, 123, 110, 102, 100, 93, 91, 84, 83]
        };

        // Section navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            // Trigger resize to fix chart sizing
            window.dispatchEvent(new Event('resize'));
        }

        // Highlight genre across all elements
        function highlightGenre(genre) {
            // Highlight genre cards
            document.querySelectorAll('.genre-card').forEach(card => {
                if (card.dataset.genre === genre) {
                    card.classList.add('highlighted');
                    card.classList.remove('dimmed');
                } else {
                    card.classList.remove('highlighted');
                    card.classList.add('dimmed');
                }
            });

            // Update radar chart with glow effect
            const radarUpdate = genreOrder.map(g => g === genre ? 1 : 0.1);
            const radarLineUpdate = genreOrder.map(g => g === genre ? 4 : 1);
            const radarFillUpdate = genreOrder.map(g => g === genre ? genreColors[g] + '55' : genreColors[g] + '15');
            Plotly.restyle('radar-chart', { 'opacity': radarUpdate, 'line.width': radarLineUpdate, 'fillcolor': radarFillUpdate });

            // Update scatter plot with size boost
            const scatterOpacity = genreOrder.map(g => g === genre ? 1 : 0.15);
            const scatterSize = genreOrder.map(g => g === genre ? 50 : 30);
            Plotly.restyle('scatter-energy-dance', { 'marker.opacity': scatterOpacity, 'marker.size': scatterSize });

            // Update violin plot
            const violinUpdate = genreOrder.map(g => g === genre ? 1 : 0.15);
            Plotly.restyle('tempo-violin', { 'opacity': violinUpdate });
        }

        function resetHighlight() {
            document.querySelectorAll('.genre-card').forEach(card => {
                card.classList.remove('highlighted', 'dimmed');
            });

            const defaultFills = genreOrder.map(g => genreColors[g] + '33');
            Plotly.restyle('radar-chart', { 'opacity': 1, 'line.width': 2, 'fillcolor': defaultFills });
            Plotly.restyle('scatter-energy-dance', { 'marker.opacity': 0.8, 'marker.size': 40 });
            Plotly.restyle('tempo-violin', { 'opacity': 1 });
        }

        // Popularity Histogram
        Plotly.newPlot('popularity-histogram', [{
            x: Array.from({length: 101}, (_, i) => i),
            y: [89, 95, 112, 125, 138, 152, 168, 185, 202, 220, 240, 262, 285, 310, 338, 368, 400, 435, 472, 512,
                555, 600, 648, 698, 750, 800, 848, 894, 938, 978, 1015, 1048, 1078, 1105, 1128, 1148, 1165, 1178,
                1188, 1195, 1198, 1198, 1195, 1188, 1178, 1165, 1148, 1128, 1105, 1078, 1048, 1015, 978, 938, 894,
                848, 800, 750, 698, 648, 600, 555, 512, 472, 435, 400, 368, 338, 310, 285, 262, 240, 220, 202, 185,
                168, 152, 138, 125, 112, 100, 89, 79, 70, 62, 55, 48, 42, 37, 32, 28, 24, 21, 18, 15, 13, 11, 9, 7, 5, 3],
            type: 'bar',
            marker: {
                color: Array.from({length: 101}, (_, i) => `rgba(45, 106, 79, ${0.3 + (i/100) * 0.7})`),
            },
            hovertemplate: 'Popularity: %{x}<br>Tracks: %{y}<extra></extra>'
        }], {
            ...baseLayout,
            xaxis: { ...baseLayout.xaxis, title: { text: 'Popularity Score', font: { color: colors.muted } } },
            yaxis: { ...baseLayout.yaxis, title: { text: 'Number of Tracks', font: { color: colors.muted } } },
            bargap: 0.1
        }, config);

        // Genre Pie Chart
        const pieColors = data.genres.map(g => genreColors[g === 'r&b' ? 'r&b' : g]);
        Plotly.newPlot('genre-pie', [{
            values: data.genreCounts,
            labels: data.genres.map(g => g.toUpperCase()),
            type: 'pie',
            marker: {
                colors: pieColors
            },
            textinfo: 'label+percent',
            textfont: { color: colors.background, size: 12 },
            hovertemplate: '%{label}<br>%{value:,} tracks<br>%{percent}<extra></extra>',
            pull: Array(6).fill(0)
        }], {
            ...baseLayout,
            showlegend: false,
            margin: { t: 20, r: 20, b: 20, l: 20 }
        }, config);

        // Genre Popularity Bar
        const sortedIndices = data.genrePopularity.map((v, i) => [v, i]).sort((a, b) => b[0] - a[0]).map(x => x[1]);
        const barColors = sortedIndices.map(i => genreColors[data.genres[i] === 'r&b' ? 'r&b' : data.genres[i]]);
        Plotly.newPlot('genre-popularity-bar', [{
            x: sortedIndices.map(i => data.genrePopularity[i]),
            y: sortedIndices.map(i => data.genres[i].toUpperCase()),
            type: 'bar',
            orientation: 'h',
            marker: {
                color: barColors
            },
            text: sortedIndices.map(i => data.genrePopularity[i].toFixed(1)),
            textposition: 'outside',
            textfont: { color: colors.foreground },
            hovertemplate: '%{y}<br>Avg Popularity: %{x:.1f}<extra></extra>'
        }], {
            ...baseLayout,
            xaxis: { ...baseLayout.xaxis, title: { text: 'Average Popularity', font: { color: colors.muted } }, range: [0, 55] },
            yaxis: { ...baseLayout.yaxis, automargin: true },
            margin: { t: 20, r: 60, b: 50, l: 80 }
        }, config);

        // Overview highlight functions
        function highlightOverviewGenre(genreLabel) {
            const genreLower = genreLabel.toLowerCase();
            const pieIndex = data.genres.indexOf(genreLower);
            const barIndex = sortedIndices.indexOf(data.genres.indexOf(genreLower));

            // Update pie - pull out highlighted slice, dim others
            const pullValues = data.genres.map((_, i) => i === pieIndex ? 0.1 : 0);
            const pieColorUpdate = pieColors.map((c, i) => i === pieIndex ? c : c + '40');
            Plotly.restyle('genre-pie', {
                'pull': [pullValues],
                'marker.colors': [pieColorUpdate]
            });

            // Update bar - highlight matching bar, dim others
            const barColorUpdate = barColors.map((c, i) => {
                const originalGenreIndex = sortedIndices[i];
                return originalGenreIndex === pieIndex ? c : c + '40';
            });
            Plotly.restyle('genre-popularity-bar', {
                'marker.color': [barColorUpdate]
            });
        }

        function resetOverviewHighlight() {
            Plotly.restyle('genre-pie', {
                'pull': [Array(6).fill(0)],
                'marker.colors': [pieColors]
            });
            Plotly.restyle('genre-popularity-bar', {
                'marker.color': [barColors]
            });
        }

        // Add hover events for pie chart
        document.getElementById('genre-pie').on('plotly_hover', function(eventData) {
            const label = eventData.points[0].label;
            highlightOverviewGenre(label);
        });

        document.getElementById('genre-pie').on('plotly_unhover', function() {
            resetOverviewHighlight();
        });

        // Add hover events for bar chart
        document.getElementById('genre-popularity-bar').on('plotly_hover', function(eventData) {
            const label = eventData.points[0].y;
            highlightOverviewGenre(label);
        });

        document.getElementById('genre-popularity-bar').on('plotly_unhover', function() {
            resetOverviewHighlight();
        });

        // Correlation Bar Chart
        const corrColors = data.correlations.map(c => c >= 0 ? colors.primary : colors.pop);
        Plotly.newPlot('correlation-bar', [{
            x: data.correlations,
            y: data.features,
            type: 'bar',
            orientation: 'h',
            marker: { color: corrColors },
            text: data.correlations.map(c => c >= 0 ? `+${c.toFixed(3)}` : c.toFixed(3)),
            textposition: 'outside',
            textfont: { color: colors.foreground, size: 11 },
            hovertemplate: '%{y}<br>Correlation: %{x:.3f}<extra></extra>'
        }], {
            ...baseLayout,
            xaxis: { ...baseLayout.xaxis, title: { text: 'Correlation with Popularity', font: { color: colors.muted } }, range: [-0.2, 0.15] },
            yaxis: { ...baseLayout.yaxis, automargin: true },
            margin: { t: 20, r: 80, b: 50, l: 120 },
            shapes: [{
                type: 'line',
                x0: 0, x1: 0,
                y0: -0.5, y1: data.features.length - 0.5,
                line: { color: colors.muted, width: 1, dash: 'dash' }
            }]
        }, config);

        // Feature Boxplots
        const featureData = ['danceability', 'energy', 'acousticness', 'valence'];
        const boxTraces = [];
        ['Low (0-33)', 'Medium (34-66)', 'High (67-100)'].forEach((tier, i) => {
            featureData.forEach(feature => {
                const baseVal = feature === 'danceability' ? 0.65 : feature === 'energy' ? 0.7 : feature === 'acousticness' ? 0.18 : 0.5;
                const shift = i === 0 ? -0.05 : i === 2 ? 0.05 : 0;
                boxTraces.push({
                    y: Array.from({length: 50}, () => baseVal + shift + (Math.random() - 0.5) * 0.3),
                    x: Array(50).fill(feature),
                    type: 'box',
                    name: tier,
                    marker: { color: i === 0 ? colors.muted : i === 1 ? colors.primaryLight : colors.primary },
                    showlegend: feature === 'danceability'
                });
            });
        });
        Plotly.newPlot('feature-boxplots', boxTraces, {
            ...baseLayout,
            boxmode: 'group',
            legend: { x: 0.5, y: 1.1, orientation: 'h', xanchor: 'center', font: { color: colors.foreground } },
            xaxis: { ...baseLayout.xaxis, title: { text: 'Audio Feature', font: { color: colors.muted } } },
            yaxis: { ...baseLayout.yaxis, title: { text: 'Feature Value', font: { color: colors.muted } }, range: [0, 1] },
            margin: { t: 50, r: 30, b: 60, l: 60 }
        }, config);

        // Radar Chart - using genreOrder for consistent highlighting
        const radarFeatures = ['Danceability', 'Energy', 'Speechiness', 'Acousticness', 'Valence'];
        const radarTraces = genreOrder.map(genre => {
            const features = data.genreFeatures[genre];
            return {
                type: 'scatterpolar',
                r: [features.danceability, features.energy, features.speechiness * 3, features.acousticness, features.valence, features.danceability],
                theta: [...radarFeatures, radarFeatures[0]],
                fill: 'toself',
                fillcolor: genreColors[genre] + '33',
                line: { color: genreColors[genre], width: 2 },
                name: genre.toUpperCase(),
                customdata: Array(6).fill(genre)
            };
        });
        Plotly.newPlot('radar-chart', radarTraces, {
            ...baseLayout,
            polar: {
                radialaxis: { visible: true, range: [0, 1], showticklabels: false, gridcolor: 'rgba(255,255,255,0.1)', linecolor: 'rgba(255,255,255,0.1)' },
                angularaxis: { gridcolor: 'rgba(255,255,255,0.1)', linecolor: 'rgba(255,255,255,0.1)', tickfont: { size: 11, color: colors.muted } },
                bgcolor: 'rgba(0,0,0,0)'
            },
            showlegend: false,
            margin: { t: 30, r: 50, b: 30, l: 50 }
        }, config);

        // Add hover events for radar
        document.getElementById('radar-chart').on('plotly_hover', function(eventData) {
            const genre = eventData.points[0].customdata;
            if (genre) highlightGenre(genre);
        });

        document.getElementById('radar-chart').on('plotly_unhover', function() {
            resetHighlight();
        });

        // Energy vs Danceability Scatter - with hover interactivity
        const scatterTraces = genreOrder.map(genre => {
            const features = data.genreFeatures[genre];
            return {
                x: [features.danceability],
                y: [features.energy],
                mode: 'markers+text',
                type: 'scatter',
                name: genre.toUpperCase(),
                text: [genre.toUpperCase()],
                textposition: 'top center',
                textfont: { color: genreColors[genre], size: 12 },
                marker: { color: genreColors[genre], size: 40, opacity: 0.8 },
                hovertemplate: `${genre.toUpperCase()}<br>Danceability: %{x:.2f}<br>Energy: %{y:.2f}<extra></extra>`,
                customdata: [genre]
            };
        });

        Plotly.newPlot('scatter-energy-dance', scatterTraces, {
            ...baseLayout,
            xaxis: { ...baseLayout.xaxis, title: { text: 'Danceability', font: { color: colors.muted } }, range: [0.45, 0.8] },
            yaxis: { ...baseLayout.yaxis, title: { text: 'Energy', font: { color: colors.muted } }, range: [0.5, 0.9] },
            showlegend: false,
            margin: { t: 10, r: 10, b: 40, l: 40 }
        }, config);

        // Add hover events for scatter
        document.getElementById('scatter-energy-dance').on('plotly_hover', function(eventData) {
            const genre = eventData.points[0].customdata;
            highlightGenre(genre);
        });

        document.getElementById('scatter-energy-dance').on('plotly_unhover', function() {
            resetHighlight();
        });

        // Tempo Violin
        const tempoData = {
            'pop': { mean: 120.7, std: 25 },
            'rap': { mean: 120.7, std: 30 },
            'rock': { mean: 125.0, std: 28 },
            'latin': { mean: 118.6, std: 22 },
            'r&b': { mean: 114.2, std: 28 },
            'edm': { mean: 125.8, std: 15 }
        };
        const tempoTraces = genreOrder.map(genre => {
            const {mean, std} = tempoData[genre];
            return {
                y: Array.from({length: 100}, () => mean + (Math.random() - 0.5) * std * 2),
                type: 'violin',
                name: genre.toUpperCase(),
                box: { visible: true },
                meanline: { visible: true },
                line: { color: genreColors[genre] },
                fillcolor: genreColors[genre] + '66',
                opacity: 1,
                customdata: Array(100).fill(genre)
            };
        });

        Plotly.newPlot('tempo-violin', tempoTraces, {
            ...baseLayout,
            yaxis: { ...baseLayout.yaxis, title: { text: 'Tempo (BPM)', font: { color: colors.muted } } },
            showlegend: false,
            margin: { t: 10, r: 10, b: 40, l: 40 }
        }, config);

        // Add hover events for violin
        document.getElementById('tempo-violin').on('plotly_hover', function(eventData) {
            const genre = eventData.points[0].customdata;
            if (genre) highlightGenre(genre);
        });

        document.getElementById('tempo-violin').on('plotly_unhover', function() {
            resetHighlight();
        });

        // Top Artists Bar
        Plotly.newPlot('top-artists-bar', [{
            x: data.artistCounts,
            y: data.topArtists,
            type: 'bar',
            orientation: 'h',
            marker: {
                color: data.artistCounts.map((_, i) => `rgba(45, 106, 79, ${1 - i * 0.08})`)
            },
            text: data.artistCounts,
            textposition: 'outside',
            textfont: { color: colors.foreground },
            hovertemplate: '%{y}<br>%{x} tracks<extra></extra>'
        }], {
            ...baseLayout,
            xaxis: { ...baseLayout.xaxis, title: { text: 'Number of Tracks', font: { color: colors.muted } }, range: [0, 190], type: 'linear', autorange: false, showticklabels: false },
            yaxis: { ...baseLayout.yaxis, automargin: true, autorange: 'reversed' },
            margin: { t: 20, r: 60, b: 50, l: 180 }
        }, config);

        // Add hover events for genre cards
        document.querySelectorAll('.genre-card').forEach(card => {
            card.addEventListener('mouseenter', () => highlightGenre(card.dataset.genre));
            card.addEventListener('mouseleave', resetHighlight);
        });
    </script>
</body>
</html>
